import json
import boto3

dynamodb = boto3.resource('dynamodb', region_name='us-east-1')
table = dynamodb.Table('jobs')

def lambda_handler(event, context):

    headers = {
        "Access-Control-Allow-Origin": "*",
        "Access-Control-Allow-Headers": "Content-Type",
        "Access-Control-Allow-Methods": "OPTIONS,GET,POST"
    }

    try:
        method = event.get("httpMethod")

        # POST JOB
        if method == "POST":
            body = json.loads(event["body"])

            table.put_item(
                Item={
                    "title": body["title"],
                    "company": body["company"],
                    "location": body["location"],
                    "description": body["description"]
                }
            )

            return {
                "statusCode": 200,
                "headers": headers,
                "body": json.dumps("Job posted successfully")
            }

        # GET JOBS
        elif method == "GET":
            response = table.scan()
            jobs = response["Items"]

            return {
                "statusCode": 200,
                "headers": headers,
                "body": json.dumps(jobs)
            }

        # OPTIONS (CORS)
        elif method == "OPTIONS":
            return {
                "statusCode": 200,
                "headers": headers,
                "body": json.dumps("OK")
            }

        else:
            return {
                "statusCode": 400,
                "headers": headers,
                "body": json.dumps("Unsupported method")
            }

    except Exception as e:
        return {
            "statusCode": 500,
            "headers": headers,
            "body": json.dumps(str(e))
        }
